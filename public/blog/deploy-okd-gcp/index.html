<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>Michaeltrip.nl :: Open Source Consultant | Deploying OpenShift OKD in GCP (Google Cloud)</title>
  <meta property="og:title" content="Michaeltrip.nl :: Open Source Consultant | Deploying OpenShift OKD in GCP (Google Cloud)" />
  <meta property="og:image" content="https://michaeltrip.nl/img/myownface.jpg" />
  <meta name="description" content="">
  <meta property="og:description" content="" />
  <meta name="author" content="Michael Trip">
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Saira+Extra+Condensed:100,200,300,400,500,600,700,800,900&display=swap">
  <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap" as="style" onload="this.onload=null;this.rel='stylesheet'">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&display=swap">
  <link rel="preload" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/devicons/1.8.0/css/devicons.min.css" integrity="sha512-JW3fT0YTK7pT7w437SoX6GcW76jOZ6E0jGmrqBAcloC4GKT+njHOY4fX5KxJ9WfIXTkNrAF994525fAHp+KCxg==" crossorigin="anonymous">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.5.5/css/simple-line-icons.min.css" integrity="sha512-QKC1UZ/ZHNgFzVKSAhV5v5j73eeL9EEN289eKAEFaAjgAiobVAnVv/AGuPbXsKl1dNoel3kNr6PYnSiTzVVBCw==" crossorigin="anonymous">
  
  <link rel="preload" href="https://michaeltrip.nl/css/resume.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://michaeltrip.nl/css/resume.css">
  <link rel="preload" href="https://michaeltrip.nl/css/tweaks.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://michaeltrip.nl/css/tweaks.css">
  <link rel="preload" href="https://michaeltrip.nl/css/resume-override.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="https://michaeltrip.nl/css/resume-override.css">
  <meta name="generator" content="Hugo 0.110.0">
  
   
  
</head>
<body id="page-top">
  <nav class="navbar navbar-expand-lg navbar-dark bg-primary fixed-top" id="sideNav">
  <a class="navbar-brand js-scroll-trigger" href="#page-top">
    <span class="d-block d-lg-none">Michael Trip</span>
    <span class="d-none d-lg-block">
      <img class="img-fluid img-profile rounded-circle mx-auto mb-2" src="../../img/myownface.jpg" alt="">
    </span>
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link js-scroll-trigger" href="../../#about">About</a>
      </li>
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="../../#skills">Skills</a>
          </li>
      
      
      
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="../../#experience">Experience</a>
          </li>
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="../../#education">Education</a>
          </li>
      
      
          <li class="nav-item">
            <a class="nav-link js-scroll-trigger" href="../../blog">Blog</a>
          </li>
      
    </ul>
  </div>
</nav>

  <div class="container-fluid p-0">
    
<nav aria-label="breadcrumb">
  <ol  class="breadcrumb">
    





<li class="breadcrumb-item">
  <a href="https://michaeltrip.nl/">Home</a>
</li>


<li class="breadcrumb-item">
  <a href="https://michaeltrip.nl/blog/">Blog</a>
</li>


<li class="breadcrumb-item active">
  <a href="https://michaeltrip.nl/blog/deploy-okd-gcp/">Deploying OpenShift OKD in GCP (Google Cloud)</a>
</li>

  </ol>
</nav>




<section class="resume-section p-3 p-lg-5 d-flex flex-column">
  <div class="my-auto">
  	<div class="mb-3 d-flex flex-row justify-content-between">
    	<h2 class="mb-0"><span class="text-primary">Deploying OpenShift OKD in GCP (Google Cloud)</span></h2>
    	<span class="">October 6, 2022</span>
    </div>
    <div>
    	<h2 id="intro">Intro</h2>
<p>After trying to create a SNO Openshift Node in my Homelab, it was time to scale it up even further and trying to create a OpenShift cluster in the cloud.
For this use case i will be using GCP.</p>
<h2 id="preperations">Preperations</h2>
<p>First, there are some preperations to be done;</p>
<ol>
<li>A service account in GCP with a <em>lot</em> of permissions in GCP</li>
<li>Enable certain API&rsquo;s in GCP</li>
<li>A Managed DNS zone in GCP</li>
<li>Both the <code>oc</code> binary and the <code>openshift-install</code> binary.</li>
<li>Create a directory structure.</li>
</ol>
<h3 id="create-a-service-account-in-gcp">Create a Service account in GCP</h3>
<ul>
<li>Go to the Google Cloud Console; <a href="https://cloud.google.com">https://cloud.google.com</a> and log-in there. Go to your favorite project, mine is called <code>michaeltcloud</code>.</li>
<li>Go to the <code>IAM &amp; Admin</code> menu en choose <code>ServiceAccounts</code>.</li>
<li>Click on the button &ldquo;Create Service Account&rdquo;</li>
</ul>
<figure><img src="../../img/blog20220610/screenshot1.png"
         alt="screenshot1" width="960px"/>
</figure>

<p>Fill in the name and click on &ldquo;Create and Continue&rdquo;. After that, you can grant roles to the newly created service account. <a href="https://docs.openshift.com/container-platform/4.11/installing/installing_gcp/installing-gcp-account.html#installation-gcp-service-account_installing-gcp-account">This is the official list from Red Hat</a></p>
<p>Required roles during installation:</p>
<ul>
<li>Compute Admin</li>
<li>Security Admin</li>
<li>Service Account Admin</li>
<li>Service Account User</li>
<li>Storage Admin</li>
<li>DNS Administrator</li>
<li>Service Account Key Admin</li>
</ul>
<figure><img src="../../img/blog20220610/screenshot3.png"
         alt="screenshot3" width="960px"/>
</figure>

<p>After selecting all roles your service account is ready.</p>
<p>Click on Done. After that, go to the <code>service account</code> page and click on the three-dots next to the newly created service account and click on <code>Manage keys</code>
Click on <code>Add key</code> and choose <code>Create New Key</code>. Choose JSON and download the newly created json file and store it somewhere safe. Afer that, create a directory in your home directory called <code>.gcp</code> and place this file in the directory with the name <code>osServiceAccount.json</code>.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> The installer will also create 2 new service accounts so the nodes can use them to interact with the google cloud API. The Roles for each type of service account:</p>
</blockquote>
<figure><img src="../../img/blog20220610/screenshot2.png"
         alt="screenshot2" width="960px"/>
</figure>

<h3 id="enabling-apis">Enabling APIs</h3>
<p>For the installer to work properly, we need to enable certain APIs. This is the table of APIs that need to be enabled.</p>
<table>
<thead>
<tr>
<th>API service</th>
<th>Console service name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Compute Engine API</td>
<td>compute.googleapis.com</td>
</tr>
<tr>
<td>Google Cloud APIs</td>
<td>cloudapis.googleapis.com</td>
</tr>
<tr>
<td>Cloud Resource Manager API</td>
<td>cloudresourcemanager.googleapis.com</td>
</tr>
<tr>
<td>Google DNS API</td>
<td>dns.googleapis.com</td>
</tr>
<tr>
<td>IAM Service Account Credentials API</td>
<td>iamcredentials.googleapis.com</td>
</tr>
<tr>
<td>Identity and Access Management (IAM) API</td>
<td>iam.googleapis.com</td>
</tr>
<tr>
<td>Service Management API</td>
<td>servicemanagement.googleapis.com</td>
</tr>
<tr>
<td>Service Usage API</td>
<td>serviceusage.googleapis.com</td>
</tr>
<tr>
<td>Google Cloud Storage JSON API</td>
<td>storage-api.googleapis.com</td>
</tr>
<tr>
<td>Cloud Storage</td>
<td>storage-component.googleapis.com</td>
</tr>
</tbody>
</table>
<p>This can easily be done by using the <code>gcloud</code> cli tool.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 ~<span style="color:#f92672">]</span>$ gcloud services enable compute.googleapis.com
</span></span></code></pre></div><p>Run this command for every api and you are done.</p>
<h3 id="creating-a-managed-dns-zone">Creating a managed DNS zone</h3>
<p>as mentioned before, OpenShift heavily relies on DNS. So it is key to have DNS zone in your GCP project.</p>
<p>But how do you do that? If you have a spare domain, you can add it entirely to GCP. But you can also designate a subdomain to GCP. That is what i have done. I have a dedicated sub domain zone called <code>gcp.alcatrash.net</code>. The only thing you need to do is create a few <code>NS</code> records at your DNS provider and you are good to go.</p>
<p>These are my NS records for example:</p>
<figure><img src="../../img/blog20220610/screenshot4.png"
         alt="screenshot4" width="960px"/>
</figure>

<p>After that, you can create a DNS zone in GCP. Go to your project, search for <code>Cloud DNS</code>. and click on <code>Create Zone</code>.</p>
<p>The <code>zone name</code> will be your sub domain, the <code>DNS Name</code> will be your base domain. After that, click on create.</p>
<h3 id="downloading-the-installer">Downloading the installer</h3>
<p>The installer is available at the <code>Releases</code> page on the Github of the OKD Project. <a href="https://github.com/okd-project/okd/releases">https://github.com/okd-project/okd/releases</a></p>
<p>In this demo we will download the <code>4.11.0-0.okd-2022-08-20-022919</code> version.
Scroll down to the assets and copy the links for both the <code>openshift-client</code> and the <code>openshift-install</code> and do a <code>wget</code> for those files. After that, extract them somewhere in a directory in your <code>$PATH</code>.</p>
<h3 id="create-a-directory-structure">Create a directory structure</h3>
<p>Now, create a directory in your home directory called <code>okd_deploy</code> and a sub directory called <code>install_dir</code>.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 ~<span style="color:#f92672">]</span>$ mkdir -p okd_deploy/install_dir
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 ~<span style="color:#f92672">]</span>$ cd okd_deploy/
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>└── install_dir
</span></span></code></pre></div><p>After that, you are all set. The only thing we need to do is configure the <code>yaml</code> file that will contain all the information for the <code>openshift-install</code> to do its work</p>
<h2 id="the-yaml-file-that-will-do-the-magic">The YAML file that will do the magic</h2>
<p>The yaml file called <code>install-config.yaml</code> can be either generated by running the <code>openshift-install</code> program interactively. After that, you can edit it to fit your own needs. For now, i will provide the <code>install-config.yaml</code> for you so you don&rsquo;t have to go into the interactive setup mode.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">baseDomain</span>: <span style="color:#ae81ff">gcp.alcatrash.net</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">compute</span>:
</span></span><span style="display:flex;"><span>- <span style="color:#f92672">architecture</span>: <span style="color:#ae81ff">amd64</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hyperthreading</span>: <span style="color:#ae81ff">Enabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">worker</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">platform</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gcp</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">osDisk</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">diskType</span>: <span style="color:#ae81ff">pd-ssd</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">diskSizeGB</span>: <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">controlPlane</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">architecture</span>: <span style="color:#ae81ff">amd64</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">hyperthreading</span>: <span style="color:#ae81ff">Enabled</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">master</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">platform</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">gcp</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">osDisk</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">diskType</span>: <span style="color:#ae81ff">pd-ssd</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">diskSizeGB</span>: <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">creationTimestamp</span>: <span style="color:#66d9ef">null</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">okdlab</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">networking</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">clusterNetwork</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">cidr</span>: <span style="color:#ae81ff">10.128.0.0</span><span style="color:#ae81ff">/14</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">hostPrefix</span>: <span style="color:#ae81ff">23</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">machineNetwork</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#f92672">cidr</span>: <span style="color:#ae81ff">10.0.0.0</span><span style="color:#ae81ff">/16</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">networkType</span>: <span style="color:#ae81ff">OVNKubernetes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceNetwork</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ae81ff">172.30.0.0</span><span style="color:#ae81ff">/16</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">platform</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">gcp</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">projectID</span>: <span style="color:#ae81ff">michaeltcloud</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">region</span>: <span style="color:#ae81ff">europe-west4</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">publish</span>: <span style="color:#ae81ff">External</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">pullSecret</span>: <span style="color:#e6db74">&#39;{&#34;auths&#34;:{&#34;....&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">sshKey</span>: |<span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  </span>  <span style="color:#ae81ff">ssh-rsa AAAAB3NzaC1yc.....</span>
</span></span></code></pre></div><p>This is the basic yaml file needed for the <code>openshift-install</code> to do it&rsquo;s work. I will try to explain some things:</p>
<h3 id="basedomain-directive"><code>baseDomain</code> directive</h3>
<p>The base domain directive is your DNS zone you created in GCP. In my case it is called <code>gcp.alcatrash.net</code>.</p>
<h3 id="replicas-0-directive-in-the-worker-section"><code>replicas: 0</code> directive in the <code>worker</code> section</h3>
<p>I have explicitely specified that there will be <code>0</code> workers. In that case, we only have a 3 node cluster with combined functions: <code>etcd</code>, <code>controlPlane</code> and <code>worker</code> capabilities. Ofcourse, this is not best practice, but for a lab environment it is perfect.</p>
<h3 id="metadataname-directive"><code>metadata.name</code> directive</h3>
<p>This is the name of your <code>okd</code> cluster, and also will be part of the DNS. Every app will get a DNS record like <code>appname.apps.okd.gcp.alcatrash.net</code> in my case.</p>
<h3 id="platformgcpregion-directive"><code>platform.gcp.region</code> directive</h3>
<p>The region my virtual machines will be deployed.</p>
<h3 id="pullsecret-directive"><code>pullSecret</code> directive</h3>
<p>As mentioned in my <a href="https://michaeltrip.nl/blog/openshift-sno-in-homelab/">previous</a> blog a pull secret is needed for this to work. You can get your pull secret from the Red Hat site. Please check my previous blog for more details</p>
<h3 id="ssh-key-directive"><code>ssh-key</code> directive</h3>
<p>Paste your public ssh key in here. This can come in handy when ssh&rsquo;ing into your nodes.</p>
<h2 id="running-the-installer">Running the installer</h2>
<p>After you created your own personal <code>install-config.yaml</code>, copy it into the <code>install_dir</code> directory:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ cp install-config.yaml install_dir/
</span></span></code></pre></div><p>After that, we can run the following command to create the manifests that the installer will use to configure the Openshift cluster:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ openshift-install create manifests --dir<span style="color:#f92672">=</span>install_dir/
</span></span><span style="display:flex;"><span>INFO Credentials loaded from file <span style="color:#e6db74">&#34;/home/michael/.gcp/osServiceAccount.json&#34;</span>
</span></span><span style="display:flex;"><span>INFO Consuming Install Config from target directory
</span></span><span style="display:flex;"><span>WARNING Making control-plane schedulable by setting MastersSchedulable to true <span style="color:#66d9ef">for</span> Scheduler cluster settings
</span></span><span style="display:flex;"><span>INFO Manifests created in: install_dir/manifests and install_dir/openshift
</span></span></code></pre></div><p>As you can see, the installer gives a warning that we don&rsquo;t have any worker nodes, to the masters will be schedulable. This is fine, because it is a lab environment anyway.</p>
<p>After that, we can create the ignition files. The ignition files are used for the Virtual machines. Ignition files contain information for <code>CoreOS</code> to know what to install and what to do.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ openshift-install create ignition-configs --dir<span style="color:#f92672">=</span>install_dir/
</span></span><span style="display:flex;"><span>INFO Consuming Common Manifests from target directory
</span></span><span style="display:flex;"><span>INFO Consuming OpenShift Install <span style="color:#f92672">(</span>Manifests<span style="color:#f92672">)</span> from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Openshift Manifests from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Master Machines from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Worker Machines from target directory
</span></span><span style="display:flex;"><span>INFO Ignition-Configs created in: install_dir and install_dir/auth
</span></span></code></pre></div><p>The files are now created. Let&rsquo;s see which files are created here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ tree
</span></span><span style="display:flex;"><span>.
</span></span><span style="display:flex;"><span>├── install-config.yaml
</span></span><span style="display:flex;"><span>└── install_dir
</span></span><span style="display:flex;"><span>    ├── auth
</span></span><span style="display:flex;"><span>    │   ├── kubeadmin-password
</span></span><span style="display:flex;"><span>    │   └── kubeconfig
</span></span><span style="display:flex;"><span>    ├── bootstrap.ign
</span></span><span style="display:flex;"><span>    ├── master.ign
</span></span><span style="display:flex;"><span>    ├── metadata.json
</span></span><span style="display:flex;"><span>    └── worker.ign
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span> directories, <span style="color:#ae81ff">7</span> files
</span></span></code></pre></div><p>Now, it is time to create the cluster in GCP:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ openshift-install create cluster --dir<span style="color:#f92672">=</span>install_dir/
</span></span><span style="display:flex;"><span>INFO Consuming Bootstrap Ignition Config from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Master Ignition Config from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Worker Ignition Config from target directory
</span></span><span style="display:flex;"><span>INFO Credentials loaded from file <span style="color:#e6db74">&#34;/home/michael/.gcp/osServiceAccount.json&#34;</span>
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><p>This will take anywhere between 20 - 40 minutes. In this time, you will see resources being created. I think the resources are created by <code>terraform</code>.</p>
<p>After a while, the setup has ended.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>michael@michael-nb2 okd_deploy<span style="color:#f92672">]</span>$ openshift-install create cluster --dir<span style="color:#f92672">=</span>install_dir/
</span></span><span style="display:flex;"><span>INFO Consuming Bootstrap Ignition Config from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Master Ignition Config from target directory
</span></span><span style="display:flex;"><span>INFO Consuming Worker Ignition Config from target directory
</span></span><span style="display:flex;"><span>INFO Credentials loaded from file <span style="color:#e6db74">&#34;/home/michael/.gcp/osServiceAccount.json&#34;</span>
</span></span><span style="display:flex;"><span>INFO Creating infrastructure resources...
</span></span><span style="display:flex;"><span>INFO Waiting up to 20m0s <span style="color:#f92672">(</span><span style="color:#66d9ef">until</span> 5:16PM<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> the Kubernetes API at https://api.okdlab.gcp.alcatrash.net:6443...
</span></span><span style="display:flex;"><span>INFO API v1.24.0-2368+b62823b40c2cb1-dirty up
</span></span><span style="display:flex;"><span>INFO Waiting up to 30m0s <span style="color:#f92672">(</span><span style="color:#66d9ef">until</span> 5:29PM<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> bootstrapping to complete...
</span></span><span style="display:flex;"><span>INFO Destroying the bootstrap resources...
</span></span><span style="display:flex;"><span>INFO Waiting up to 40m0s <span style="color:#f92672">(</span><span style="color:#66d9ef">until</span> 5:55PM<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> the cluster at https://api.okdlab.gcp.alcatrash.net:6443 to initialize...
</span></span><span style="display:flex;"><span>INFO Waiting up to 10m0s <span style="color:#f92672">(</span><span style="color:#66d9ef">until</span> 5:31PM<span style="color:#f92672">)</span> <span style="color:#66d9ef">for</span> the openshift-console route to be created...
</span></span><span style="display:flex;"><span>INFO Install complete!
</span></span><span style="display:flex;"><span>INFO To access the cluster as the system:admin user when using <span style="color:#e6db74">&#39;oc&#39;</span>, run
</span></span><span style="display:flex;"><span>INFO     export KUBECONFIG<span style="color:#f92672">=</span>/home/michael/okd_deploy/install_dir/auth/kubeconfig
</span></span><span style="display:flex;"><span>INFO Access the OpenShift web-console here: https://console-openshift-console.apps.okdlab.gcp.alcatrash.net
</span></span><span style="display:flex;"><span>INFO Login to the console with user: <span style="color:#e6db74">&#34;kubeadmin&#34;</span>, and password: <span style="color:#e6db74">&#34;xyz&#34;</span>
</span></span><span style="display:flex;"><span>INFO Time elapsed: 28m2s
</span></span></code></pre></div><h2 id="done">Done</h2>
<p>After clicking the console url you will encounter some self-signed certificate errors. Ignore these, becaust it is only a lab environment.</p>
<p>after logging in with the <code>kubeadmin</code> user we can see the shiny web interface of OKD.</p>
<figure><img src="../../img/blog20220610/screenshot5.png"
         alt="screenshot5" width="960px"/>
</figure>

<p>And there it is, your own 3  node OpenShift / OKD cluster. You can do everything with it. For example; i used it when studying for the DO280 exam.</p>
<p>Have fun! And if you have any questions, please contact me through email / linkedin / github or whatever ;-)</p>

	    
	</div>
    <div>
    	
    </div>
    <ul class="tags">
    
</ul>

  </div>
</section>


    <span style="color: #999999; font-size: 60%;">Nifty <a href="https://codepen.io/wbeeftink/pen/dIaDH">tech tag lists</a> from <a class="pen-owner-link" href="https://codepen.io/wbeeftink">Wouter Beeftink</a> </span>
    
  </div>
  
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

  
  <script async src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js" integrity="sha512-0QbL0ph8Tc8g5bLhfVzSqxe9GERORsKhIn1IrpxDAgUsbBGz/V7iSav2zzW325XGd1OMLdL4UiqRJj702IeqnQ==" crossorigin="anonymous"></script>
  
  <script async src="../../js/resume.js"></script>
  <script async src="https://www.googletagmanager.com/gtag/js?id="></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', '');
  </script>
  
  <a href='http://ipv6-test.com'><img src='http://v4v6.ipv6-test.com/imgtest.png' alt='ipv6 test' title='ipv6 test' border='0' /></a>

  

</body>
</html>
